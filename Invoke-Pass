# Simple ADSI example (uses current context - Kerberos if possible)
$ldapPath = "LDAP://dc01.example.com/DC=example,DC=com"
$root = [ADSI]$ldapPath

# Search
$searcher = New-Object System.DirectoryServices.DirectorySearcher($root)
$searcher.Filter = "(objectClass=user)"
$searcher.PageSize = 1000
$searcher.PropertiesToLoad.AddRange(@("sAMAccountName","displayName","mail")) | Out-Null

$results = $searcher.FindAll()
foreach ($r in $results) {
    $props = $r.Properties
    [PSCustomObject]@{
        SAMAccountName = ($props["samaccountname"] | Select-Object -First 1)
        DisplayName    = ($props["displayname"]    | Select-Object -First 1)
        Mail           = ($props["mail"]           | Select-Object -First 1)
    }
}
